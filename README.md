tetrics.proto
====

tetrics ( https://github.com/yuiwai/tetrics ) とやり取りをするためのprotobuf定義です。

## リクエスト

tetrics側から、現在のゲームの状態が送信されます。  
バージョン文字列については現在は"0.1"で固定です。

## レスポンス

tetrics側に返すアクションのリストです。  
例えば、「右回転」「左移動」「上へドロップ」のように、一連のアクションをまとめて返すことができます。


## フィールド

tetricsでは一般的な10x10のフィールドが全部で5つ存在ます。  
中央は、プレイヤーがブロックを回転させたり移動させたりするためのフィールドで、その周囲4方向にブロックを積み上げるためのフィールドがあります。  

フィールドは上から下に向かって10行分のデータを持っています。  
行は左から右に向かって、10列分のデータを持っています。  
テトリス同様、一行を埋めることでその行を消すことができます。

## ブロック

テトリスで言うところのテトリミノです。これをフィールドに積み上げることでゲームは進行します。  
データ構造的にはフィールドと同様に行と列の2次元配列構造として扱われます。

## プレイサイクル

ゲームが開始されると、中央のフィールドにランダムに選択されたブロックが配置されます。  
このブロックを左右に回転させるか、上下左右に移動させ、4方向のうちのいずれかのフィールドにドロップするまでが1サイクルとなります。  
ドロップ後は再びブロックが抽選され、中央のフィールドに配置されます。

## 座標

左上を原点(0, 0)として、右にxが増加、下にyが増加していく座標系となっています。  
ブロックの座標も左上を基準として処理されます。

たとえば、2x2の四角いブロックを

- フィールドの左上に配置した場合の座標は (0, 0)
- フィールドの右上に配置した場合の座標は (8, 0)
- フィールドの左下に配置した場合の座標は (0, 8)
- フィールドの右下に配置した場合の座標は (8, 8)

となります

## 回転について

回転時のブロックの座標計算は以下のルールに従っています。  

`元の座標 + (回転前の幅(or高さ) - 回転後の幅(or高さ)) / 2`

2で割った際には切り上げか切り捨てが発生しますが、どちらを採用するかの判定は以下のようになっています。

- 初期配置時の状態から、右もしくは左に回転することで、内部ステータスが遷移し、一回転（4回の状態遷移）すると元のステータスに戻ります。
  - 初期ステータスから右に一回転するときは、座標の端数が「切り上げ」「切り捨て」「切り捨て」「切り上げ」の順に処理されます。
  - 初期ステータスから左に一回転するときは、座標の端数が「切り捨て」「切り捨て」「切り上げ」「切り上げ」の順に処理されます。

たとえば、初期ステータスで4x1の細長いブロックを(4, 4)に配置し

- 右回転したときの座標は (6, 3)
- 左回転したときの座標は (5, 2)

となります

## フィールド端での挙動について

ブロックを回転／移動させた際に、フィールド外にはみ出てしまうようなケースでは、自動で位置の補正は行われず、単にそのアクションが無視されます。

## ドロップ

中央のフィールドで位置や回転を調整したのちに周囲の4方向のうちのいずれかのフィールドにブロックを落す操作をドロップと呼びます。  
下方向へのドロップは直感的ですが、その他の方向に関しては注意が必要です。

- 上方向へのドロップ時は、フィールドが180°回転しています
- 左右方向へのドロップ寺は、それぞれフィールドが90°回転しています


